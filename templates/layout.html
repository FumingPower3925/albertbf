<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="{{description}}">
  <title>{{title}}</title>
  <style>{{styles}}</style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Search functionality
      let searchIndex = [];
      
      async function loadSearchIndex() {
        try {
          const response = await fetch('/search-index.json');
          searchIndex = await response.json();
        } catch (err) {
          console.warn('Could not load search index:', err);
        }
      }
      
      function performSearch(query) {
        if (!query.trim()) {
          showAllArticles();
          return;
        }
        
        const lowerQuery = query.toLowerCase();
        const results = searchIndex.filter(article => 
          article.title.toLowerCase().includes(lowerQuery) ||
          article.description.toLowerCase().includes(lowerQuery) ||
          article.content.toLowerCase().includes(lowerQuery) ||
          (article.projectName && article.projectName.toLowerCase().includes(lowerQuery))
        );
        
        hideAllArticles();
        results.forEach(result => {
          const articleCard = document.querySelector(`[data-title*="${result.title.toLowerCase()}"]`);
          if (articleCard) {
            articleCard.style.display = 'block';
            articleCard.classList.add('fade-in');
          }
        });
        
        const visibleArticles = document.querySelectorAll('.article-card[style*="block"], .article-card:not([style*="none"])');
        if (results.length === 0) {
          showNoResults();
        } else {
          hideNoResults();
        }
      }
      
      function showAllArticles() {
        const articles = document.querySelectorAll('.article-card');
        articles.forEach(article => {
          article.style.display = 'block';
          article.classList.add('fade-in');
        });
        hideNoResults();
      }
      
      function hideAllArticles() {
        const articles = document.querySelectorAll('.article-card');
        articles.forEach(article => {
          article.style.display = 'none';
          article.classList.remove('fade-in');
        });
      }
      
      function showNoResults() {
        let noResults = document.getElementById('no-results');
        if (!noResults) {
          noResults = document.createElement('div');
          noResults.id = 'no-results';
          noResults.className = 'minimal-card text-center';
          noResults.innerHTML = '<p>No articles found matching your search.</p>';
          document.querySelector('.articles-container')?.appendChild(noResults);
        }
        noResults.style.display = 'block';
      }
      
      function hideNoResults() {
        const noResults = document.getElementById('no-results');
        if (noResults) {
          noResults.style.display = 'none';
        }
      }

      // Initialize search
      loadSearchIndex();
      
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => performSearch(e.target.value));
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            searchInput.value = '';
            showAllArticles();
          }
        });
      }
      
      // Fade-in animation
      const elements = document.querySelectorAll('.minimal-card, .article-card');
      elements.forEach((el, index) => {
        setTimeout(() => el.classList.add('fade-in'), index * 100);
      });

      const navLinks = document.querySelectorAll('nav a');
      const currentPath = window.location.pathname;

      navLinks.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === '/' && currentPath === '/') {
          console.log(linkPath, currentPath);
          link.classList.add('active');
        } else if (linkPath !== '/' && currentPath.startsWith(linkPath)) {
          console.log(linkPath, currentPath);
          link.classList.add('active');
        } else {
          console.log(linkPath, currentPath);
        }
      });
    });
  </script>
</head>
<body>
  <nav>
    <ul>
      <li><a href="/">Articles</a></li>
      <li><a href="/projects/">Projects</a></li>
    </ul>
  </nav>
  
  <main>
    <div class="container">
      {{content}}
    </div>
  </main>
</body>
</html>