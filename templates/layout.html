<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="{{description}}">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
  <title>{{title}}</title>
  <style>{{styles}}</style>
  <script>
    (function() {
      const theme = localStorage.getItem('theme') || 'light';
      if (theme === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>
</head>
<body>
  <nav>
    <ul>
      <li><a href="/">Articles</a></li>
      <li><a href="/projects/">Projects</a></li>
    </ul>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
      <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
      <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </button>
  </nav>
  
  <main>
    <div class="container">
      {{content}}
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('theme-toggle');
      const docElement = document.documentElement;

      function applyTheme(theme) {
        if (theme === 'dark') {
          docElement.classList.add('dark-mode');
        } else {
          docElement.classList.remove('dark-mode');
        }
      }

      themeToggle.addEventListener('click', () => {
        const currentTheme = docElement.classList.contains('dark-mode') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
      });
      
      const savedTheme = localStorage.getItem('theme') || 'light';
      applyTheme(savedTheme);

      function initCodeCopy() {
        const copyButtons = document.querySelectorAll('.code-copy-btn');
        
        copyButtons.forEach(button => {
          button.addEventListener('click', async () => {
            const code = button.getAttribute('data-code');
            const copyText = button.querySelector('.copy-text');
            const originalText = copyText.textContent;
            
            try {
              await navigator.clipboard.writeText(code);
              
              button.classList.add('copied');
              copyText.textContent = 'Copied!';
              
              button.querySelector('svg').innerHTML = `
                <polyline points="20 6 9 17 4 12"></polyline>
              `;
              
              setTimeout(() => {
                button.classList.remove('copied');
                copyText.textContent = originalText;
                
                button.querySelector('svg').innerHTML = `
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                `;
              }, 2000);
            } catch (err) {
              const textArea = document.createElement('textarea');
              textArea.value = code;
              textArea.style.position = 'fixed';
              textArea.style.left = '-999999px';
              document.body.appendChild(textArea);
              textArea.focus();
              textArea.select();
              
              try {
                document.execCommand('copy');
                button.classList.add('copied');
                copyText.textContent = 'Copied!';
                
                setTimeout(() => {
                  button.classList.remove('copied');
                  copyText.textContent = originalText;
                }, 2000);
              } catch (err) {
                console.error('Failed to copy code:', err);
                copyText.textContent = 'Failed';
                
                setTimeout(() => {
                  copyText.textContent = originalText;
                }, 2000);
              }
              
              document.body.removeChild(textArea);
            }
          });
        });
      }
      
      initCodeCopy();
      
      let searchIndex = [];
      
      async function loadSearchIndex() {
        try {
          const response = await fetch('/search-index.json');
          searchIndex = await response.json();
        } catch (err) {
          console.warn('Could not load search index:', err);
        }
      }
      
      function performSearch(query) {
        if (!query.trim()) {
          showAllArticles();
          return;
        }
        
        const lowerQuery = query.toLowerCase();
        const results = searchIndex.filter(article => 
          article.title.toLowerCase().includes(lowerQuery) ||
          article.description.toLowerCase().includes(lowerQuery) ||
          article.content.toLowerCase().includes(lowerQuery) ||
          (article.projectName && article.projectName.toLowerCase().includes(lowerQuery)) ||
          (article.tags && article.tags.join(' ').toLowerCase().includes(lowerQuery))
        );
        
        hideAllArticles();
        results.forEach(result => {
          const articleCard = document.querySelector(`[data-title*="${result.title.toLowerCase()}"]`);
          if (articleCard) {
            articleCard.style.display = 'block';
            articleCard.classList.add('fade-in');
          }
        });
        
        const visibleArticles = document.querySelectorAll('.article-card[style*="block"], .article-card:not([style*="none"])');
        if (results.length === 0) {
          showNoResults();
        } else {
          hideNoResults();
        }
      }
      
      function showAllArticles() {
        const articles = document.querySelectorAll('.article-card');
        articles.forEach(article => {
          article.style.display = 'block';
          article.classList.add('fade-in');
        });
        hideNoResults();
      }
      
      function hideAllArticles() {
        const articles = document.querySelectorAll('.article-card');
        articles.forEach(article => {
          article.style.display = 'none';
          article.classList.remove('fade-in');
        });
      }
      
      function showNoResults() {
        let noResults = document.getElementById('no-results');
        if (!noResults) {
          noResults = document.createElement('div');
          noResults.id = 'no-results';
          noResults.className = 'minimal-card text-center';
          noResults.innerHTML = '<p>No articles found matching your search.</p>';
          document.querySelector('.articles-container')?.appendChild(noResults);
        }
        noResults.style.display = 'block';
      }
      
      function hideNoResults() {
        const noResults = document.getElementById('no-results');
        if (noResults) {
          noResults.style.display = 'none';
        }
      }

      loadSearchIndex();
      
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => performSearch(e.target.value));
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            searchInput.value = '';
            showAllArticles();
          }
        });
      }
      
      const articleCards = document.querySelectorAll('.article-card');
      articleCards.forEach(card => {
        card.style.cursor = 'pointer';
        card.addEventListener('click', (e) => {
          if (e.target.tagName === 'A') return;
          
          const link = card.querySelector('h2 a');
          if (link) {
            window.location.href = link.href;
          }
        });
      });

      const projectArticles = document.querySelectorAll('.project-article');
      projectArticles.forEach(article => {
        article.style.cursor = 'pointer';
        article.addEventListener('click', (e) => {
          if (e.target.tagName === 'A') return;
          
          const link = article.querySelector('a');
          if (link) {
            window.location.href = link.href;
          }
        });
      });

      const elements = document.querySelectorAll('.minimal-card, .article-card');
      elements.forEach((el, index) => {
        setTimeout(() => el.classList.add('fade-in'), index * 100);
      });

      const navLinks = document.querySelectorAll('nav a');
      const currentPath = window.location.pathname;

      navLinks.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === '/' && currentPath === '/') {
          link.classList.add('active');
        } else if (linkPath !== '/' && currentPath.startsWith(linkPath)) {
          link.classList.add('active');
        }
      });
      
      const nav = document.querySelector('nav');
      let lastScrollY = window.scrollY;

      window.addEventListener('scroll', () => {
        if (lastScrollY < window.scrollY && window.scrollY > 100) {
          nav.classList.add('nav--hidden');
        } else {
          nav.classList.remove('nav--hidden');
        }
        lastScrollY = window.scrollY;
      });

      document.addEventListener('mousemove', e => {
        if (e.clientY < 60) {
          nav.classList.remove('nav--hidden');
        }
      });
    });
  </script>
</body>
</html>